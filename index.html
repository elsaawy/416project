<html>

    <div style="text-align: center; position: relative;">
        <h1>
        Visualizing Influences on Military Spending
        </h1>
        <h2 id="viz_title"><br></h2>
    </div>

    <style>
        /* set document font style */
        html * {
            font-family: verdana;
            zoom: 100%;
        }
        .horizontal-center {
          margin: 0;
          position: absolute;
          left: 50%;
          -ms-transform: translateX(-50%);
          transform: translateX(-50%);
        }
    </style>

    <!-- Load packages -->
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- Load annotations package -->
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.js"></script> 

    <!-- Create the main visualization element -->
    <div id="viz_area"> </div>

    <script>
    // Initialize data variable (allows data variable sharing between functions.)
    var data_spending;
    var data_spending_raw;
    var data_events;
    var data_recc;
    
    
    
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////                   Figure 0                                    //////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    async function init() {
        // Read the Data
        
        data_spending = await d3.csv('https://elsaawy.github.io/416project/government_and_spending_CPI_adj.csv')
        data_spending_raw = await d3.csv('https://elsaawy.github.io/416project/spending_raw.csv')
        data_events = await d3.csv('https://elsaawy.github.io/416project/Events.csv', function(d){
                        return {Name : d.Name, Category : d.Category, Type : d.Type, Date: d3.timeParse("%m-%d-%Y")(d.Date)}})
        data_recc = await d3.csv('https://elsaawy.github.io/416project/recession_indicators.csv', function(d){
                        return { Date : d3.timeParse("%Y-%m-%d")(d.Date), Indicator : d.Indicator }})


        document.getElementById("viz_area").innerHTML = ""
        // set the dimensions and margins of the graph
        var windowSize = document.getElementById('viz_area').getBoundingClientRect()
        var margin = {top: 50, right: 200, bottom: 50, left: 50},
            svgWidth = windowSize.width - (margin.right),
            svgHeight = 600;
        
        // append the svg objects to the body of the page
        d3.select("#viz_area")
            .append("div")
            .attr("id", "div1")

        var svg1 = d3.select("#div1")
            .append("svg")
            .attr("id", "svg1")
            .attr("width", svgWidth)
            .attr("height", svgHeight)
            .attr("overflow", "visible");
        
        // Get the column headers of the CSV file
        var keys = ['Operation_Maintenance', 'Personnel', 'Procurement', 'R_D', 'AEC', 'Construction', 'Defense-related', 'Housing']
        console.log(keys)

        // X-AXIS
        var x = d3.scaleLinear()
            .domain(d3.extent(data_spending_raw, function(d) { return d.Year; }))
            .range([ 0, svgWidth - 200 ]);

        var xAxis = svg1.append("g")
            .attr("transform", "translate(100," + (svgHeight-100) + ")")
            .call(d3.axisBottom(x).ticks(28).tickFormat(d3.format("d")))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.5em")
            .attr("dy", ".20em")
            .attr("transform", "rotate(-50)")

        // Add X axis label:
        svg1.append("text")
            .attr("text-anchor", "start")
            .attr("x", svgWidth - 150 )
            .attr("y", (svgHeight - 50) )
            .text("Year");
        
        // Add Y axis
        var y = d3.scaleLinear()
            .domain([0, 900_000])
            .range([ svgHeight-125, 0 ]);

        svg1.append("g")
            .attr("transform", "translate(100,25)")
            .call(d3.axisLeft(y))
        
        // Add Y axis label:
        svg1.append("text")
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "central")
            .attr("x", -175)
            .attr("y", 30)
            .text("Spending in Millions (US $)")
            .attr("transform", "rotate(-90)")
        
        // COLOR Axis (use the column headers to make a color for each category)
        var c = d3.scaleOrdinal()
            .domain(keys)
            .range(["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#17becf","#7f7f7f","#bcbd22"])

        //stack the data for area chart
        var stackedData = d3.stack()
            .keys(keys)
            .order(d3.stackOrderAscending)
            (data_spending_raw)
        console.log("This is the stack result: ", stackedData)

        // Function to calculate area of each segment
        var area = d3.area()
                .x(function(d, i) { return x(d.data.Year); })
                .y0(function(d) { return y(d[0]); })
                .y1(function(d) { return y(d[1]); })
            
        svg1.selectAll("mylayers")
            .data(stackedData)
            .enter()
            .append("path")
                .attr("class", function(d) { return "myArea " + d.key })
                .style("fill", function(d) { console.log(d.key) ; return c(d.key); })
                .attr("d", area)
                .attr("transform", "translate(100,25)")

        //////////
        // HIGHLIGHT GROUP //
        //////////

        // What to do when one group is hovered
        var highlight = function(d){
            console.log(d)
            // reduce opacity of all groups
            d3.selectAll(".myArea").style("opacity", .1)
            // except the one that is hovered
            d3.select("."+d).style("opacity", 1)
        }

        // And when it is not hovered anymore
        var noHighlight = function(d){
            d3.selectAll(".myArea").style("opacity", 1)
        }

    ////////////////
    //Annotations///
    ////////////////
    const annotations = [
        {
          note: {
            label: "1979",
            title: "Period of rapid growth",
            wrap: 200
          },
          data: {x: "1979", y: 100_000},
          dy: -150,
          dx: 0
        },{
          note: {
            label: "1991"
          },
          data: {x: "1991", y: 300_000},
          dy: -45,
          dx: -1
        },{
          note: {
            label: "2001",
            title: "Period of rapid growth",
            wrap: 200
          },
          data: {x: "2001", y: 300_000},
          dy: -240,
          dx: 0
        },{
          note: {
            label: "2011",
            wrap: 75
          },
          data: {x: "2011", y: 700_000},
          dy: -30,
          dx: -1
        }]

        const makeAnnotations = d3.annotation()
            .type(d3.annotationCallout)
            .accessors({ 
            x: function(d){ return x(d.x) + 100},
            y: function(d){ return y(d.y) + 20}
            })
            .annotations(annotations)

        d3.select("#svg1")
            .append("g")
            .style("font", "10px times")
            .attr("class", "annotation-group")
            .call(makeAnnotations)

        //////////
        // LEGEND //
        //////////

        // Add one dot in the legend for each name.
        var size = 20
        svg1.selectAll("myrect")
            .data(keys)
            .enter()
            .append("rect")
                .attr("x", svgWidth - 70)
                .attr("y", function(d,i){ return svgHeight/4 + i*(size+5)})
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d){ return c(d)})
                .on("mouseover", highlight)
                .on("mouseleave", noHighlight)

        // Key to Label Mapping
        var title = d3.scaleOrdinal()
            .domain(keys)
            .range(['Operation & Maintenance','Personnel','Procurement','Atomic Energy',
                    'R & D', 'Construction', 'Defense Related', 'Housing'])
        // Add one dot in the legend for each name.
        svg1.selectAll("mylabels")
            .data(keys)
            .enter()
            .append("text")
                .attr("x", svgWidth - 70 + size*1.2)
                .attr("y", function(d,i){ return svgHeight/4 + i*(size+5) + (size/2)}) 
                .text(function(d){ return title(d)})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")
                .on("mouseover", highlight)
                .on("mouseleave", noHighlight)

        button = document.getElementById("button_area")
        button.innerHTML='<button type="button" id="button1" onclick=func1()> <b style="font-family:verdana"> NEXT </b></button>'
        viz_title =document.getElementById("viz_title") 
        viz_title.innerHTML="Growth of Military Spending Over the Past 50 Years"
        document.getElementById("text_area").innerHTML="&emsp;&emsp;Between 1962 to 2022 national defense spending has grown from 52.35 B to 765.82 B USD, "+
        "a <b>1,462% increase</b>! <br> Of the 8.0 Trillion USD reported by the " + 
        "<a href='https://www.whitehouse.gov/omb/budget/historical-tables/'>US Whitehouse</a> spent in 2022, " + 
        "this represents over 10 percent of the annual government spending. " +
        "As we can see in the figure above, this is not a steady growth, certain periods exhibit dramatic increases in defense spending. " +
        "The annotations mark periods of higher growth rates between 1979 to 1991, 2001 to 2011, and that we are in a current period of " + 
        "increased growth. " +
        "Before we can explore the important question of what drove these periods of rapid growth, "+
        "we need to adjust the spending figures to account for an important factor... inflation." +
        "<br><br> Hover over the legend items to focus on a specific category!"+
        "<br> Click <b>NEXT</b> to see the figure updated for inflation."

    }        

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////                   FUNCTION 1                                  //////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async function func1() {
        // Read the data (CPI adjusted categorical data)
        data_spending_raw = await d3.csv('https://elsaawy.github.io/416project/spending_raw_CPI_adj.csv')

        //Clear visualization element
        document.getElementById("viz_area").innerHTML = ""

        // Calculate the dimensions and margins of the graphs based on window sizing
        var windowSize = document.getElementById('viz_area').getBoundingClientRect()
        var margin = {top: 50, right: 200, bottom: 50, left: 50},
            svgWidth = windowSize.width - (margin.right),
            svgHeight = 600;
        
        // append the svg objects to the body of the page
        d3.select("#viz_area")
            .append("div")
            .attr("id", "div1")

        var svg1 = d3.select("#div1")
            .append("svg")
            .attr("id", "svg1")
            .attr("width", svgWidth)
            .attr("height", svgHeight)
            .attr("overflow", "visible");
        
        // Create array of keys of the CSV file (standardizes layout)
        var keys = ['Operation_Maintenance', 'Personnel', 'Procurement', 'R_D', 'AEC', 'Construction', 'Defense-related', 'Housing']
        console.log(keys)

        // X-AXIS
        var x = d3.scaleLinear()
            .domain(d3.extent(data_spending_raw, function(d) { return d.Year; }))
            .range([ 0, svgWidth - 200 ]);

        var xAxis = svg1.append("g")
            .attr("transform", "translate(100," + (svgHeight-100) + ")")
            .call(d3.axisBottom(x).ticks(28).tickFormat(d3.format("d")))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.5em")
            .attr("dy", ".20em")
            .attr("transform", "rotate(-50)")

        // Add X axis label:
        svg1.append("text")
            .attr("text-anchor", "start")
            .attr("x", svgWidth - 150 )
            .attr("y", (svgHeight - 50) )
            .text("Year");
        
        // Y-Axis
        var y = d3.scaleLinear()
            .domain([0, 900_000])
            .range([ svgHeight-125, 0 ]);

        svg1.append("g")
            .attr("transform", "translate(100,25)")
            .call(d3.axisLeft(y))
        
        // Add Y axis label:
        svg1.append("text")
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "central")
            .attr("x", -175)
            .attr("y", 30)
            .text("Spending in Millions (US $)")
            .attr("transform", "rotate(-90)")
        
        // COLOR Axis (use the column headers to make a color for each category)
        var c = d3.scaleOrdinal()
            .domain(keys)
            .range(["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#17becf","#7f7f7f","#bcbd22"])

        //////////
        // HIGHLIGHT Legend //
        //////////

        // What to do when one group is hovered
        var highlight = function(d){
            console.log(d)
            // reduce opacity of all groups
            d3.selectAll(".myArea").style("opacity", .1)
            // except the one that is hovered
            d3.select("."+d).style("opacity", 1)
        }

        // And when it is not hovered anymore
        var noHighlight = function(d){
            d3.selectAll(".myArea").style("opacity", 1)
        }

        //stack the data for area chart
        var stackedData = d3.stack()
            .keys(keys)
            .order(d3.stackOrderAscending)
            (data_spending_raw)
        console.log("This is the stack result: ", stackedData)

        // Function to calculate area of each segment
        var area = d3.area()
                .x(function(d, i) { return x(d.data.Year); })
                .y0(function(d) { return y(d[0]); })
                .y1(function(d) { return y(d[1]); })
        
        // Plot the lines and areas of the stacked area chart.
        svg1.selectAll("mylayers")
            .data(stackedData)
            .enter()
            .append("path")
                .attr("class", function(d) { return "myArea " + d.key })
                .style("fill", function(d) { console.log(d.key) ; return c(d.key); })
                .attr("d", area)
                .attr("transform", "translate(100,25)")

        ///////////////
        //Annotations//
        ///////////////
        const annotations = [
        {
          note: {
            label: "1965",
            title: "Period of rapid growth",
            wrap: 63
          },
          data: {x: "1965", y: 435_000},
          color: "red",
          dy: -150,
          dx: 0
        },{
          note: {
            label: "1968"
          },
          data: {x: "1968.2", y: 610_000},
          color: "red",
          dy: -57.5,
          dx: -1
        },{
          note: {
            label: "1979",
            title: "Period of rapid growth",
            wrap: 200
          },
          data: {x: "1979", y: 420_000},
          dy: -150,
          dx: 0
        },{
          note: {
            label: "1986"
          },
          data: {x: "1986", y: 660_000},
          color: "red",
          dy: -23.5,
          dx: -1
        },{
          note: {
            label: "2001",
            title: "Period of rapid growth",
            wrap: 200
          },
          data: {x: "2001", y: 450_000},
          dy: -225,
          dx: 0
        },{
          note: {
            label: "2010",
            wrap: 75
          },
          data: {x: "2010", y: 850_000},
          color: "red",
          dy: -15,
          dx: -.1
        }]

        const makeAnnotations = d3.annotation()
            .type(d3.annotationCallout)
            .accessors({ 
            x: function(d){ return x(d.x) + 100},
            y: function(d){ return y(d.y) + 20}
            })
            .annotations(annotations)

        d3.select("#svg1")
            .append("g")
            .style("font", "10px times")
            .attr("class", "annotation-group")
            .call(makeAnnotations)

        ////////////
        // LEGEND //
        ////////////

        // Add one dot in the legend for each name.
        var size = 20
        svg1.selectAll("myrect")
        .data(keys)
        .enter()
        .append("rect")
            .attr("x", svgWidth - 70)
            .attr("y", function(d,i){ return svgHeight/4 + i*(size+5)}) 
            .attr("width", size)
            .attr("height", size)
            .style("fill", function(d){ return c(d)})
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

        // Key to Label Mapping
        var title = d3.scaleOrdinal()
            .domain(keys)
            .range(['Operation & Maintenance','Personnel','Procurement','Atomic Energy',
                    'R & D', 'Construction', 'Defense Related', 'Housing'])
        // Add one dot in the legend for each name.
        svg1.selectAll("mylabels")
        .data(keys)
        .enter()
        .append("text")
            .attr("x", svgWidth - 70 + size*1.2)
            .attr("y", function(d,i){ return svgHeight/4 + i*(size+5) + (size/2)}) 
            .text(function(d){ return title(d)})
            .attr("text-anchor", "left")
            .style("alignment-baseline", "middle")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

        // Update the navigation buttons
        button = document.getElementById("button_area")
        button.innerHTML='<button type="button" id="button1" onclick=init()> <b style="font-family:verdana"> BACK </b></button>' +
                         '\t' + 
                         '<button type="button" id="button2" onclick=func2()> <b style="font-family:verdana"> NEXT </b></button>'
        // Update the chart title
        viz_title =document.getElementById("viz_title") 
        viz_title.innerHTML="Inflation Adjusted Growth of Military Spending Over the Past 50 Years"
        // Update discussion text
        document.getElementById("text_area").innerHTML="&emsp;&emsp;In the previous visualization we saw a dramtic increase in national defense "+
        "spending over 50 years. Because of the time scale of the spending values, we must adjust for inflation to accurately compare " +
        "spending, this data was adjusted to 2021 USD using the Consumer Price Index (CPI) from the " +
        "<a href='https://www.minneapolisfed.org/about-us/monetary-policy/inflation-calculator/consumer-price-index-1913-'>Federal Reserve Bank of Minneapolis</a>" +
        "The basic formula is: Adjusted Value = Actual Value * (2022 CPI / Current CPI). " +
        "Adjusting for CPI reveals a different story in the growth of national defense spending. Now we see that defense spending " +
        "grew from 468 B to 709 B USD over 50 years, a growth of 151%. Looking closer at the figure, we see that "+
        "not all categories grew proportionally (hover over the legend categories to highlight a specific group). " + 
        "For example, spending on personnel remained relatively constant over 50 years, " +
        "whereas procurement and operations and maintenance spending had the most variability. " +
        "The annotations also mark the periods of rapid growth, and we can see the emergence of periods that we could not identitify " +
        "in the previous figure, as well as a change in the previous date ranges identified. We also see that "+
        "while national defense spending appeared to be at its highest in the most recent years, when adjusted for inflation, " +
        "defense spending peaked in 2011. " + 
        "With this overview of defense spending trends, we can begin to address the central question: " +
        "<u>what are the primary factors that drive growth in national defense spending?</u> " +
        "Our next step is to correlate events with the data to visualize correlation and identify potential cause and effect relationships." +
        
        "<br><br> Hover over the legend items to highlight that specific category!" +
        "<br> Click <b>NEXT</b> to see the detailed annual growth information and correlation of "+
        "recession data, administration political party, and inflation rates to defense spending trends."
    }   

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////                   FUNCTION 2                                  //////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async function func2() {

        document.getElementById("viz_area").innerHTML = ""
        
        var windowSize = document.getElementById('viz_area').getBoundingClientRect()

        var margin = {top: 50, right: 200, bottom: 50, left: 50},
            svg1Width = windowSize.width - (margin.right),
            svg1Height = 600 * 3/10,
            svg2Width = windowSize.width - (margin.right),
            svg2Height = 600 * 7/10;

        
        // append the svg objects to the body of the page
        d3.select("#viz_area")
            .append("div")
            .attr("id", "div1")

        var svg1 = d3.select("#div1")
            .append("svg")
            .attr("width", svg1Width)
            .attr("height", svg1Height)
            .attr("overflow", "visible");

        d3.select("#viz_area")
            .append("div")
            .attr("id", "div2")
            .attr("height", svg2Height)

        var svg2 = d3.select("#div2")
            .append("svg")
            .attr("id", "svg1")
            .attr("width", svg2Width)
            .attr("height", svg2Height)
            .attr("overflow", "visible");

    ///////////////
    //AXES (SVG1)// Bar Plot of Growth  --- NEED THESE EARLY FOR TOOLTIP SIZES
    ///////////////

        // Y1 Axis:
        var y1 = d3.scaleLinear()
                .domain([-20, 20] )
                .range([svg1Height - 50, 0 ]); //25px padding top and bottom

        svg1.append("g")
                .attr("transform", "translate(100,25)")
                .call(d3.axisLeft(y1))
        
        svg1.append("text")
            .attr("text-anchor", "end")
            .attr("dominant-baseline", "central")
            .attr("x", -40)
            .attr("y", 50)
            .text("Percentage")
            .attr("transform", "rotate(-90)")

        // X1 Axis
        // Growth rate represents growth between years. Therefore adjust the scale and use bands
        var years = data_spending.map(function(d) { return d.Year ; });
        years = years.slice(1, years.length)

        var x1 = d3.scaleBand()
            .domain(years)
            .range([ 0, svg1Width - 200 ]) //100px padding on each side
            .padding(0.1)
        
        var x1Axis = svg1.append("g")
            .attr("transform", "translate(100," + (y1(0) + 25) + ")")
            .call(d3.axisBottom(x1).tickFormat(''))

        // Color scale
        var c1 = d3.scaleQuantize()
            .domain([-100,100])
            .range(['maroon', 'green'])

        // X1_2 Axes, recession indicators and color scale
        var recc_date = data_recc.map(function(d) { return d.Date; });

        var x1_2 = d3.scaleBand()
            .domain(recc_date)
            .range([ 0, svg1Width - 200 ]) //100px padding on each side
            .padding(0.1)

        var c1_2 = d3.scaleQuantize()
            .domain([0,1])
            .range(['white', 'red'])

    //////////////
    // Tooltips //
    //////////////
        // Vertical line follower
        var focus = svg1
                        .append("g")
                        .style("opacity", 0)
                        .attr("class", "focus");

        focus
            .append("rect")
            .attr("class", "x")
            .attr("stroke", "grey")
            .attr('fill', "none")
            .style("z-index", "-10")
            .attr("width", x1.bandwidth())
            .attr("x", 100 )
            .attr("y", (svg1Height- 89) )
            .attr("height", (svg1Height + svg2Height - 191.25));

        function mouseMove(d) {
            focus.select(".x")
                .attr("transform", "translate(" + ( x1(d.Year)) + ",0)")
        }

        // Create a tooltip (details on demand) object
        var Tooltip = d3.select("#div2")
            .append("div")
            .style("opacity", 0)
            .style("z-index", "10")
            .style("position", "absolute")
            .attr("class", "tooltip")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "5px")
            .style("padding", "5px")

        // Functions for Tooltip for hover over SVG1
        var mouseover1 = function(d) {
            Tooltip
                .style("opacity", .95)
                .style("z-index", "10")
            focus.style("opacity", 1)
                .style("z-index", "10");
        }
        var mouseleave1 = function(d) {
            Tooltip
                .style("opacity", 0)
                .style("z-index", "-1") //Hides the tooltip for densely packed data
            focus.style("opacity", 0)
                .style("z-index", "-1");
        }
        var mousemove1 = function(d) {
            Tooltip
                .style("left", (d3.event.pageX+10)+"px")
                .style("top", (d3.event.pageY-10)+"px")
                .html("<center><u>"+ (d.Year-1) +" - " + (d.Year) + "</center></u>" +
                      "Growth:    &emsp;   " + d.PercentGrowth + "%" + 
                      "<br>Annual Inflation: " + Math.round(d.InflationRate * 100)+ "%" +
                      "<br>President:          " + d.President +
                      "<br>Government:         " + d.Division);
            mouseMove(d);
        }

        //SVG 2 Tooltip function ---  For the defense spending plot
        var mouseover2 = function(d) {
            Tooltip
                .style("opacity", .95)
                .style("z-index", "10");
            focus.style("opacity", 1)
                .style("z-index", "-1");
            }
        var mouseleave2 = function(d) {
            Tooltip
                .style("opacity", 0)
                .style("z-index", "-1"); //Hides the tooltip for densely packed data
            focus.style("opacity", 0)
                .style("z-index", "-1");
            }
        var mousemove2 = function(d) {
            Tooltip
                .style("left", (d3.event.pageX+10)+"px")
                .style("top", (d3.event.pageY-10)+"px")
                .html("<center><u>"+ d.Year + "</center></u>" +
                      "Spending:   $"+  Math.round(d.NationalDefenseTotal_050C).toLocaleString() + " M"+ 
                      "<br>Growth:    &emsp;   " + d.PercentGrowth + "%" + 
                      "<br>President:          " + d.President +
                      "<br>Presidency:         " + d.Presidency+ 
                      "<br>Senate:             " + d.Senate +
                      "<br>House:              " + d.House)
                      ;
            mouseMove(d);
            }

    //////////
    // SVG1 // Bar Plot of Growth
    //////////
        // Draw the recession indicator backgrounds
        svg1.append("g")
            .selectAll("backgroundRect")
            .data(data_recc)
            .enter()
            .append("rect")
                .attr("x", function(d) {return x1_2(d.Date)})
                .attr("width", x1_2.bandwidth())
                .attr("height", svg1Height - 50)
                .attr("fill", function(d) { return c1_2(d.Indicator)})
                .attr("transform", "translate(100,25)")
                .attr("stroke-width", 1)
                .attr("opacity", .2)
                .attr("z-index", 0)

        // Plot the bar graph growth rate values
        svg1.append("g")
            .selectAll("rect")
            .data(data_spending)
            .enter()
            .append("rect")
                .attr("x", function(d) { return x1(d.Year ); })
                .attr("y", function(d) { 
                    if (d.PercentGrowth > 0) { return y1(d.PercentGrowth); }
                    else {return y1(0);} })
                .attr("width", x1.bandwidth())
                .attr("height", function(d) { 
                    if (d.PercentGrowth > 0) { return y1(0) -  y1(d.PercentGrowth) ;}
                    else {return y1(d.PercentGrowth) - y1(0);} })
                .attr("fill", function(d) {return c1(d.PercentGrowth)})
                .attr("transform", "translate(100,25)")
                .attr("z-index", 9)
                .on("mouseover", mouseover1)
                .on("mousemove", mousemove1)
                .on("mouseleave", mouseleave1)

        // Add the circles for inflation values
        svg1.selectAll("dot")
            .data(data_spending.slice(1, years.length+1))
            .enter()
            .append("circle")
                .attr("class", "myCircle")
                .attr("cx", function(d) { return (x1(d.Year) + (x1.bandwidth() / 2)) } )
                .attr("cy", function(d) { return y1(d.InflationRate*100) } )
                .attr("r", 2)
                .attr("stroke", "Black")
                .attr("stroke-width", 1.1)
                .attr("fill", "Black")
                .attr("transform", "translate(100,25)")
                .on("mouseover", mouseover1)
                .on("mousemove", mousemove1)
                .on("mouseleave", mouseleave1)

    /////////
    //SVG 2// --- DEFENSE SPENDING PLOT
    /////////
        // Add X axis
        var x2 = d3.scaleLinear()
            .domain(d3.extent(data_spending, function(d) { return d.Year; }))
            .range([ 0, svg2Width - 200 ]);

        var x2Axis = svg2.append("g")
            .attr("transform", "translate(100," + (svg2Height-100) + ")")
            .call(d3.axisBottom(x2).ticks(28).tickFormat(d3.format("d")))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.05em")
            .attr("dy", ".50em")
            .attr("transform", "rotate(-50)")
        
        // Add X axis label:
        svg2.append("text")
            .attr("text-anchor", "start")
            .attr("x", svg2Width - 150 )
            .attr("y", (svg2Height - 50) )
            .text("Year");
        
        // Add Y axis
        var y2 = d3.scaleLinear()
            .domain([300000, 900000])
            .range([ svg2Height-125, 0 ]);

        svg2.append("g")
            .attr("transform", "translate(100,25)")
            .call(d3.axisLeft(y2))
        
        // Add Y axis label:
        svg2.append("text")
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "central")
            .attr("x", -175)
            .attr("y", 30)
            .text("Spending in Millions (US $)")
            .attr("transform", "rotate(-90)")

        var c2 = d3.scaleOrdinal()
            .domain(['Republican Unified','Republican Divided','Democrat Divided' , 'Democrat Unified'])
            .range(['Red', 'LightCoral',  'LightSkyBlue','Blue'])

        // Add the lines
        svg2.append("path")
            .datum(data_spending)
            .attr("fill", "none")
            .attr("stroke", "black")
            .attr("stroke-width", 2.5)
            .attr("d", d3.line()
                .x(function(d) { return x2(d.Year) })
                .y(function(d) { return y2(d.NationalDefenseTotal_050C) }) )
                .attr("transform", "translate(100,25)")
        // Add the circles
        svg2.append("g")
            .selectAll("dot")
            .data(data_spending)
            .enter()
            .append("circle")
                .attr("class", "myCircle")
                .attr("cx", function(d) { return x2(d.Year) } )
                .attr("cy", function(d) { return y2(d.NationalDefenseTotal_050C) } )
                .attr("r", 5)
                .attr("stroke", function(d) {return c2(d.Presidency + d.Division)})
                .attr("stroke-width", 1.1)
                .attr("fill", function(d) {return c2(d.Presidency + d.Division)})
                .attr("transform", "translate(100,25)")
                .on("mouseover", mouseover2)
                .on("mousemove", mousemove2)
                .on("mouseleave", mouseleave2)

    /////////////
    // LEGEND 1//
    /////////////
        // Add one dot in the legend for each name.
        var size = 11
        svg1.selectAll("myrect")
            .data(["Growth", "Decline", "Recession"])
            .enter()
            .append("rect") 
                .attr("x", svg1Width - 50)
                .attr("y", function(d,i){ return 50 + i*(size+15)}) // 100 is where the first dot appears. 25 is the distance between dots
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d, i){ return ["Green", "Maroon", "#F5B7B1"][i]})
        // Add legend item for the inflation rates seperately
        svg1.append("circle")
                .attr("cx", svg1Width - 44 )
                .attr("cy", 134 )
                .attr("r", 5)
                .attr("stroke", "Black")
                .attr("stroke-width", 1)
                .attr("fill", "Black")

        // Add one dot in the legend for each name.
        svg1.selectAll("mylabels")
            .data(["Growth", "Decline", "Recession", "Inflation"])
            .enter()
            .append("text")
                .attr("x", svg1Width - 50 + size*1.5)
                .attr("y", function(d,i){ return 50 + i*(size+15) + (size/2+2)})
                .text(function(d){ return  d})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")

    //////////////
    // LEGEND 2 //
    //////////////
        // Add one block in the legend for each name.
        gov_keys = ['Republican - Unified','Republican - Divided','Democrat   - Divided' , 'Democrat  - Unified']

        var size = 11
        svg2.selectAll("myrect")
            .data(gov_keys)
            .enter()
            .append("rect") 
                .attr("x", svg2Width - 50)
                .attr("y", function(d,i){ return svg2Height/3 + i*(size+10)}) 
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d){ return c2(d)})

        // Add names
        svg2.selectAll("mylabels")
            .data(gov_keys)
            .enter()
            .append("text")
                .attr("x", svg2Width - 50 + size*1.5)
                .attr("y", function(d,i){ return svg2Height/3 + i*(size+10) + (size/2 + 2)})
                .text(function(d){ return d})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")


        //Update the navigation button
        button = document.getElementById("button_area")
        button.innerHTML='<button type="button" id="button1" onclick=func1()> <b style="font-family:verdana"> BACK </b></button>'+
            '    ' +
            '<button type="button" id="button2" onclick=func3()> <b style="font-family:verdana"> NEXT </b></button>'
        //Update the Title
        viz_title =document.getElementById("viz_title") 
        viz_title.innerHTML="Correlating Events with Inflation Adjusted Growth of Military"

        //Update the discussion text
        document.getElementById("text_area").innerHTML="&emsp;&emsp;In the previous visualizations we saw national defense spending by category "+
        "after adjusting for inflation. We will focus on the total inflation adjusted spending as we correlate various factors, " +
        "keeping in mind that not all categories of military spending grew proportionally." +
        "To help understand the magnitude of year-to-year changes, we plot the annual growth rate. as we explore the two factors." +
        "The first factors we will investigate are what most would consider the largest likely influence on government spending: "+ 
        "1) the administration's political party, and 2) the national economy." +
        "<br> &emsp;&emsp;To correlate and plot the administration's political party, we show the Presidents' political party at each data point " +
        "in the spending plot. The point is colored to represent not just the President's party, but also the administration's 'unification' " +
        "(wether or not congress is controlled by the same political party). Additional information regarding Congress is available on demand." +
        "To identify periods of recession, the <a href='https://fred.stlouisfed.org/series/USREC'> Federal Reserve of St. Louis FRED Economic Data </a> " + 
        "monthly recession indicators are used to update the growth chart with periods of recession." +
        "<br>&emsp;&emsp;According to the <a href='https://www.aei.org/foreign-and-defense-policy/the-defense-budget-through-administrations/'> "+
        "American Enterprise Institute</a>, Republican administrations, on average, increase defense spending. "+
        "However, in the figure above " +
        "we see that while this is mostly true, there are periods in which the opposite is true. For example, defense spending from 1964 - 1968 "+ 
        "grew consistently despite a unified Democrat administration, and 1968 - 1973 " +
        "is marked by constant decrease in national defense spending despite a Republican presidency."+
        "Looking at periods of recessions also does not provide insight into change in defense spending. We expect governments increase spending " +
        "back into the national economy to stimulate growth, increase employment, and stem the effects of a recession. While this is likely true of " +
        "national spending as a whole, it does not seem to be the case for national defense spending, even on a time lagged scale. " +

        "<br> &emsp;&emsp;In summary, there is a correllation between administration and spending change, and no immediate correlation between   " +
        "recession indicators and national defense spending. However, the correlation between administration and spending is not definitive. " +
        "There are likely other factors that also influence defense spending. " + 
        
        "<br><br> Hover over chart points to see details on demand!" +
        "<br> Click <b>NEXT</b> to see the correlation of major national and world events with defense spending."
    }        

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////                   FUNCTION 3                                  //////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async function func3() {
        // Clears the viz area and add buttons for the different event categories.
        // Add the buttons            
        document.getElementById("viz_area").innerHTML="&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <button id='conflictUS'>US Conflicts</button>" +
                                                        "&emsp;<button id='conflictWorld'>World Conflicts</button>" +
                                                        "&emsp;<button id='disaster'>Disasters</button>" +
                                                        "&emsp;<button id='geopolitical'>Geopolitical</button>" + 
                                                        "&emsp;<button id='All'> All </button>"
        // Update the button onclick feature (can't do this while adding because of all the quotation marks.)
        document.getElementById("conflictUS").onclick = function() {update("US Conflict");}
        document.getElementById("conflictWorld").onclick = function() {update('Non-US Conflict');}
        document.getElementById("disaster").onclick = function() {update('Disaster');}
        document.getElementById("geopolitical").onclick = function() {update('Geopolitical');}
        document.getElementById("All").onclick = function() {update('All');}

        //Calculate window and svg elements size
        var windowSize = document.getElementById('viz_area').getBoundingClientRect()

        var margin = {top: 50, right: 200, bottom: 50, left: 50},
            svg1Width = windowSize.width - (margin.right),
            svg1Height = 600 * 2/10,
            svg2Width = windowSize.width - (margin.right),
            svg2Height = 600 * 7/10;

        // append the svg objects to the body of the page
        d3.select("#viz_area")
            .append("div")
            .attr("id", "div1")

        var svg1 = d3.select("#div1")
            .append("svg")
            .attr("width", svg1Width)
            .attr("height", svg1Height)
            .attr("overflow", "visible");

        d3.select("#viz_area")
            .append("div")
            .attr("id", "div2")
            .attr("height", svg2Height)

        var svg2 = d3.select("#div2")
            .append("svg")
            .attr("id", "svg1")
            .attr("width", svg2Width)
            .attr("height", svg2Height)
            .attr("overflow", "visible");

    /////////////
    //Tooltips///
    ////////////
        // Vertical line follower
        var focus = svg1
                        .append("g")
                        .style("opacity", 0)
                        .attr("class", "focus");

        focus
            .append("rect")
            .attr("class", "x")
            .attr("stroke", "grey")
            .attr('fill', "grey")
            .style("z-index", "-10")
            .attr("width", 2)
            .attr("x", 100 )
            .attr("y", svg1Height-50 )
            .attr("height", svg1Height-50 + svg2Height-115);

        function mouseMove(d) {
            focus.select(".x")
                .attr("transform", "translate(" + ( x(d.Date) - 1) + ",0)")
        }

        // Create a tooltip for plot
        var Tooltip = d3.select("#div1")
            .append("div")
            .style("opacity", 0)
            .style("z-index", "10")
            .style("position", "absolute")
            .attr("class", "tooltip")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "5px")
            .style("padding", "5px")

        // Create the mouse move functions for the events plot
        var mouseover1 = function(d) {
            Tooltip
                .style("opacity", .95)
                .style("z-index", "10");
            focus.style("opacity", 1)
                 .style("z-index", "10");
            }
        var mouseleave1 = function(d) {
            Tooltip
                .style("opacity", 0)
                .style("z-index", "-1"); //Hides the tooltip for densely packed data
            focus.style("opacity", 0)
                 .style("z-index", "-1");
            }

        var mousemove1 = function(d) {
            Tooltip
                .style("left", (d3.event.pageX+10)+"px")
                .style("top", (d3.event.pageY-10)+"px")
                .html("<center><u>"+ d.Name + "</u></center>" + 
                      "Date:         "+ d.Date.toDateString() +
                      "<br><br>Category:  "+  d.Category+ 
                      "<br>Type:          "+ d.Type); 
                    
            mouseMove(d);}

        // Mouse movement functions For the defense spending plot
        var mouseover2 = function(d) {
            Tooltip
                .style("opacity", .95)
                .style("z-index", "10");
            }
        var mouseleave2 = function(d) {
            Tooltip
                .style("opacity", 0)
                .style("z-index", "-1"); //Hides the tooltip for densely packed data
            }
        var mousemove2 = function(d) {
            Tooltip
                .style("left", (d3.event.pageX+10)+"px")
                .style("top", (d3.event.pageY-10)+"px")
                .html("Year:  &emsp; &emsp; &emsp; &emsp; "+ d.Year +
                      "<br>Spending:   $"+  Math.round(d.NationalDefenseTotal_050C).toLocaleString() + " M"+ 
                      "<br>Growth:    &emsp;   " + d.PercentGrowth + "%" + 
                      "<br>President:          " + d.President +
                      "<br>Presidency:         " + d.Presidency+ 
                      "<br>Senate:             " + d.Senate +
                      "<br>House:              " + d.House)
            }

    ///////////
    // SVG 1 // -- Events Timeline
    ///////////
        // Create the categories for the type of events
        var eventCategories = ["US Conflict", "Non-US Conflict", "Geopolitical", "Disaster"]
        
        // Create a second axis with higher detail for the specific date of events
        var x = d3.scaleTime()
            .domain([new Date("01-01-1962"), new Date("12-31-2022")])
            .range([ 0, svg1Width - 200 ]);
        
        var xAxis = svg1.append("g")
            .attr("transform", "translate(100," + (svg1Height-50) + ")")
            .call(d3.axisBottom(x).ticks(28))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.05em")
            .attr("dy", ".50em")
            .attr("transform", "rotate(-50)")

        //Color scale for events
        var c = d3.scaleOrdinal()
            .domain(eventCategories)
            .range(['DarkOliveGreen', 'SaddleBrown', 'DarkOrange',  'RebeccaPurple'])

        function update(selectedVar) {
            //filter data set to the selected category.
            if (selectedVar === 'All') {
                data_events_filtered = data_events;
            }
            else {
                var data_events_filtered = [];
                for (var i = 0; i < data_events.length; i++)
                {
                    if (data_events[i].Category === selectedVar)
                    {
                        data_events_filtered.push(data_events[i]);
                    }
                }
                data_events_filtered = data_events_filtered.sort(function(a,b){
                    // Turn your strings into dates, and then subtract them
                    // to get a value that is either negative, positive, or zero.
                    return new Date(b.Date) - new Date(a.Date);
                    });
            }
            console.log(data_events_filtered)

            // Add the events to the graph
            svg1.selectAll("line")
                .remove()

            svg1.selectAll("line")
                .data(data_events_filtered)
                .enter()
                .append("line")
                    .on("mouseover", mouseover1)
                    .on("mousemove", mousemove1)
                    .on("mouseleave",mouseleave1)
                .transition()
                    .attr("x1", function(d) { return x(d.Date); })
                    .attr("x2", function(d) { return x(d.Date); })
                    .attr("y1", function(d,i) {if (i % 2 == 0) { return -25; }
                                                else {return -15;} })
                    .attr("y2", 0)
                    .attr("stroke", "grey")
                    .attr("transform", "translate(100,"+(svg1Height-50)+")")

            svg1.selectAll("circle")
                .remove()
            
            svg1.selectAll("circle")
                .data(data_events_filtered)
                .enter()
                .append("circle")
                    .on("mouseover", mouseover1)
                    .on("mousemove", mousemove1)
                    .on("mouseleave",mouseleave1)
                .transition()
                // .duration(1000)
                    .attr("cx", function(d) { return x(d.Date) } )
                    .attr("cy", function(d,i) {if (i % 2 == 0) { return -25; }
                                                else {return -15;} })
                    .attr("r", 4)
                    .attr("stroke", function(d) {return c(d.Category)})
                    .attr("stroke-width", 1)
                    .attr("fill", function(d) {return c(d.Category)})
                    .attr("transform", "translate(100,"+(svg1Height-50)+")")
        }
        update('US Conflict')

    /////////
    //SVG 2// -- Defense Spending plot
    /////////
        // Add X axisfor the defense spending
        var x2 = d3.scaleLinear()
            .domain(d3.extent(data_spending, function(d) { return d.Year; }))
            .range([ 0, svg1Width - 200 ]);

        var x2Axis = svg2.append("g")
            .attr("transform", "translate(100," + (svg2Height-100) + ")")
            .call(d3.axisBottom(x2).ticks(28).tickFormat(d3.format("d")))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.05em")
            .attr("dy", ".50em")
            .attr("transform", "rotate(-50)")
        
        // Add X axis label:
        svg2.append("text")
            .attr("text-anchor", "start")
            .attr("x", svg2Width - 150 )
            .attr("y", (svg2Height - 50) )
            .text("Year");

        // Add Y axis
        var y2 = d3.scaleLinear()
            .domain([300000, 900000])
            .range([ svg2Height-125, 0 ]);

        svg2.append("g")
            .attr("transform", "translate(100,25)")
            .call(d3.axisLeft(y2))
        
        // Add Y axis label:
        svg2.append("text")
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "central")
            .attr("x", -175)
            .attr("y", 30)
            .text("Spending in Millions (US $)")
            .attr("transform", "rotate(-90)")

        // Color scale for administrations
        var c2 = d3.scaleOrdinal()
            .domain(['Republican Unified','Republican Divided','Democrat Divided' , 'Democrat Unified'])
            .range(['Red', 'LightCoral',  'LightSkyBlue','Blue'])
        
        // Add the lines
        svg2.append("path")
            .datum(data_spending)
            .attr("fill", "none")
            .attr("stroke", "black")
            .attr("stroke-width", 2.5)
            .attr("d", d3.line()
                .x(function(d) { return x2(d.Year) })
                .y(function(d) { return y2(d.NationalDefenseTotal_050C) }) )
                .attr("transform", "translate(100,25)")

        // Add the circles
        svg2.append("g")
            .selectAll("dot")
            .data(data_spending)
            .enter()
            .append("circle")
                .attr("class", "myCircle")
                .attr("cx", function(d) { return x2(d.Year) } )
                .attr("cy", function(d) { return y2(d.NationalDefenseTotal_050C) } )
                .attr("r", 5)
                .attr("stroke", function(d) {return c2(d.Presidency + d.Division)})
                .attr("stroke-width", 1.1)
                .attr("fill", function(d) {return c2(d.Presidency + d.Division)})
                .attr("transform", "translate(100,25)")
                .on("mouseover", mouseover2)
                .on("mousemove", mousemove2)
                .on("mouseleave", mouseleave2)
        
    ////////////////
    //Annotations///
    ////////////////
        const annotations = [
        {
          note: {
            label: "03-08-1965",
            title: "US Enters Vietnam",
            wrap: 75
          },
          data: {x: "03-08-1965", y: 435_493},
          dy: -150,
          dx: 0,
          color: "#E8336D"
        },{
          note: {
            label: "1968",
            title: "Height of Anti-War Movement",
            wrap: 75
          },
          data: {x: "01-01-1968", y: 620_000},
          dy: 80,
          dx: 0,
          color: "#1E8449"
        },{
          note: {
            label: "03-23-1983",
            title: "Strategic Defense Initiative",
            wrap: 75
          },
          data: {x: "03-23-1983", y: 571_122},
          dy: -100,
          dx: 0,
          color: "#E8336D"
        },{
          note: {
            label: "04-30-1975",
            title: "End of Vietnam War",
            wrap: 75
          },
          data: {x: "04-30-1975", y: 415_761},
          dy: 20,
          dx: 0,
          color: "#1E8449"
        },{
          note: {
            label: "12-25-1991",
            title: "Collapse of USSR",
            wrap: 75
          },
          data: {x: "12-25-1991", y: 543_761},
          dy: -100,
          dx: 0,
          color: "#1E8449"
        },{
          note: {
            label: "09-11-2001",
            title: "9/11 Attacks",
            wrap: 75
          },
          data: {x: "09-11-2001", y: 466_304},
          dy: -120,
          dx: 0,
          color: "#E8336D"
        },{
          note: {
            label: "12-15-2011",
            title: "End of Iraq War",
            wrap: 75
          },
          data: {x: "12-15-2011", y: 850_178},
          dy: -20,
          dx: 0,          
          color: "#1E8449"
        },{
          note: {
            label: "08-30-2021",
            title: "End of Afghan War",
            wrap: 75
          },
          data: {x: "08-30-2021", y: 738_308},
          dy: 70,
          dx: -1,          
          color: "#1E8449"
        }]

        // Parse the x-value dates to a date object for plotting
        const parseTime = d3.timeParse("%m-%d-%Y")

        const makeAnnotations = d3.annotation()
            .type(d3.annotationCallout)
            .accessors({ 
            x: function(d){ return x(parseTime(d.x)) + 100},
            y: function(d){ return y2(d.y) + 20 }
            })
            .annotations(annotations)

        d3.select("#svg1")
            .append("g")
            .style("font", "10px times")
            .attr("class", "annotation-group")
            .call(makeAnnotations)

    //////////////
    // LEGEND 1 //
    //////////////

        // Add one dot in the legend for each name.
        var size = 11
        svg1.selectAll("myrect")
            .data(eventCategories)
            .enter()
            .append("rect") 
                .attr("x", svg1Width - 50)
                .attr("y", function(d,i){ return 10 + i*(size+15)})
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d){ return c(d)})

        // Key to Label Mapping

        // Add one dot in the legend for each name.
        svg1.selectAll("mylabels")
            .data(eventCategories)
            .enter()
            .append("text")
                .attr("x", svg1Width - 50 + size*1.5)
                .attr("y", function(d,i){ return 10 + i*(size+15) + (size/2+2)})
                .text(function(d){ return  d})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")

    //////////////
    // LEGEND 2 //
    //////////////

        // Add one dot in the legend for each name.
        gov_keys = ['Republican - Unified','Republican - Divided','Democrat - Divided' , 'Democrat - Unified']

        var size = 11
        svg2.selectAll("myrect")
            .data(gov_keys)
            .enter()
            .append("rect") 
                .attr("x", svg2Width - 50)
                .attr("y", function(d,i){ return svg2Height/3 + i*(size+10)}) 
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d){ return c2(d)})

        // Key to Label Mapping
        svg2.selectAll("mylabels")
            .data(gov_keys)
            .enter()
            .append("text")
                .attr("x", svg2Width - 50 + size*1.2)
                .attr("y", function(d,i){ return svg2Height/3 + i*(size+10) + (size/2+2)}) 
                .text(function(d){ return d})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")

        //Update the page
        //Update the button
        button = document.getElementById("button_area")
        button.innerHTML='<button type="button" id="button1" onclick=func2()> <b style="font-family:verdana"> BACK </b></button>'
        //Update the Title
        viz_title =document.getElementById("viz_title") 
        viz_title.innerHTML="Correlating Events with Inflation Adjusted Growth of Military"

        //Update the text
        document.getElementById("text_area").innerHTML="&emsp;&emsp; In the previous visualization we explored the impact " + 
        "of the government's political party and the national economic state on inflation adjusted defense spending. " +
        "We saw a weak correlation between political party and spending, confirming that in general, Republican administrations " +
        "drive national defense spending growth. However this was not always the case. " +
        "Another important factor to consider, are geopolitical events. We explore the impact of four main categories on " +
        "defense spending: US conflicts, Non-US conflicts, Major US disasters (the top 20 disasters by financial impact), " +
        "and general geopolitical events. Intuitively, the most important of these factors to consider is US conflicts. " +
        "Over the past 50 years, the US has been involved in a variety of conflicts, ranging from full scale campaigns, to "+
        "interventions. We see that periods in which the US launched a full scale campaingn, there is also an increase in " +
        "national defense spending. Other minor conflicts and interventions have no discernible impact on defense spending. " +
        "The end of these major campaings, such as the Iraq and Afghanistan wars also correspond to a period of decline. " +
        "Other major events, such as natural disasters, do not seem to impact national defense spending. This is likely due to " +
        "the US military playing a large role in humanitarian aid and disaster response missions. " +
        "It is clear that the major driving forces for defense spending are major US conflicts, defense related political " + 
        "events, such as the Cold War and US anti-Vietnam war sentiment, and to a lesser extent the administration's political " +
        "party. "+
        "<br><br> Hover over chart points to see specific details!" +
        "<br> Select the various categories of geopolitical events to explore their relationships to national defense spending."
        }        
    </script>

    <!-- Scene Navigation Buttons -->
    <div id="button_area" style="text-align: center; position: relative;">
        <button type="button" id="button1" > <b style="font-family:verdana"> START </b></button>
        <script>
            document.getElementById("button1").onclick = function() {document.getElementById("text_header").remove(); 
                        init();}
        </script>
    </div>

    <!-- Discussion section header -->
    <div style="text-align: center; position: relative;">
        <h2 id="text_header" style="font-family:verdana">Introduction & Instructions</h2>
    </div>

    <!-- Text/Disucssion area -->
    <p id="text_area" style="font-family:verdana">
        &emsp; &emsp; As an active duty military member, I have a vested interest in understanding the factors that 
        drive changes in national defense spending. Throughout my career, changes in defense spending have affected my pay, 
        my unit's funding, repair and maintenance scope and schedules, and deployments. 
        Understanding the factors that drive spending policy is a compelx and challenging task, however, an interesting topic. 
        Beyond the personal interest, there is also the National debt crisis to consider. This has been a major topic of
         concern in recent years, and with national defense spending comprising over 10% of recent US government spending
        [<a href="https://fiscaldata.treasury.gov/americas-finance-guide/federal-spending/">Treasury.gov</a>], and the 
        fact that the US outspends every other country in defense, it is an important subset of government spending to explore.
        
        Throughout this presentations we will explore the impact of various economic, political, and world events on 
        national defense spending. To begin, we must first get a handle on trends in spending over the last 50 years (1962-2022). 
        Then we will correlate political, economic, and world events in an attempt to identify driving factors. 
        
        <br><br>
        &emsp;&emsp; Throughout the presentation navigation buttons will be available to step forward and backwards.
        Discussions of the visualizations will appear below the figures, keep an eye out for hints on how to interact with the figures!
        <b>Press "START" above to begin.</b>   
    </p>

    <!-- Author, References, and Data Files -->
    <h3 style="font-family:verdana"><br> Author</h3>
    <p style="font-family:verdana">Haadi Elsaawy <br> helsaawy@illinois.edu</p>
    <h3 style="font-family:verdana"> References </h3>
        <p>
            Military Spending: <a href="https://www.whitehouse.gov/omb/budget/historical-tables/">US Whitehouse</a> <br>
            Inflation Data: <a href="https://www.minneapolisfed.org/about-us/monetary-policy/inflation-calculator/consumer-price-index-1913-">	Federal Reserve Bank of Minneapolis</a><br>
            U.S. Weather and Climate Disasters: <a href="https://www.ncei.noaa.gov/access/billions/events">NOAA.GOV</a><br>
            NBER based Recession Indicators for the United States: <a href="https://fred.stlouisfed.org/series/USREC"> Federal Reserve of St. Louis FRED Economic Data </a><br>
            United States Administration Political Party: <a href="https://history.house.gov/Institution/Presidents-Coinciding/Party-Government/"> US Whitehouse History </a>
        </p>
    <h3 style="font-family:verdana"> Datafiles </h3>
        <p>
        <a href='https://elsaawy.github.io/416project/government_and_spending_CPI_adj.csv'>Adjusted Military Spending, inflation rates, administration political parties (csv)</a>
        <br>
        <a href='https://elsaawy.github.io/416project/spending_raw.csv'>Unadjusted Defense Spending (csv)</a>;
        <br>
        <a href='https://elsaawy.github.io/416project/recession_indicators.csv'>Recession Indicators (csv)</a>;
        <br>
        <a href='https://elsaawy.github.io/416project/Events.csv'>Major Events and Disasters (csv)</a>
        </p>
    </h3>
    </div>
<!-- Phew. 1400+ lines later. That was fun. -->
</html>